# ===============================
# = SPRING BOOT PROPERTIES
# ===============================
spring.profiles.active=${SPRING_PROFILES_ACTIVE:development}
spring.application.name=${APPLICATION_NAME:Kavun}

# ===============================
# = SYSTEM PROPERTIES
# ===============================
system.name=${SYSTEM_NAME:Kavun}
system.email=${SYSTEM_EMAIL:noreply@kavun.com}
system.address=${SYSTEM_ADDRESS:Konya, Turkey}
system.phone=${SYSTEM_PHONE:+ 01 234 567 89}
system.url=${SYSTEM_URL:http://localhost:8080}

# ===============================
# = ADMIN LOGIN CREDENTIALS
# ===============================
admin.username=${ADMIN_USERNAME:admin}
admin.password=${ADMIN_PASSWORD:password}
admin.email=${ADMIN_EMAIL:admin@gmail.com}

# ===============================
# = AWS S3 BUCKET
# ===============================
aws.region=${AWS_REGION:us-east-1}
aws.accessKeyId=${AWS_ACCESS_KEY_ID}
aws.secretAccessKey=${AWS_SECRET_ACCESS_KEY}
aws.s3BucketName=${AWS_S3_BUCKET_NAME:spring-boot-starter}
aws.servicePort=${AWS_SERVICE_PORT:8001}
aws.serviceEndpoint=${AWS_SERVICE_ENDPOINT:http://localhost:${aws.servicePort}}

# ===============================
# = SECURITY
# ===============================
# Brute force attack counter, you can also handle this through a generic database back configuration
security.failedLoginAttempts=${SECURITY_FAILED_LOGIN_ATTEMPTS:3}
brute.force.cache.maxSize=${BRUTE_FORCE_CACHE_MAX_SIZE:1000}

# Permission settings
# Allow admin users to bypass permission checks globally
security.permission.admin-bypass-enabled=${SECURITY_PERMISSION_ADMIN_BYPASS_ENABLED:true}

# ===============================
# = JWT
# ===============================
# Encryption and Token secrets
access-token-expiration-in-minutes=${ACCESS_TOKEN_EXPIRATION_IN_MINUTES:60}
jwt.secret=${JWT_SECRET:u7x!A%D*G-KaPdSgVkYp2s5v8y/B?E(H+MbQeThWmZq4t6w9z$C&F)J@NcRfUjXn}
encryption.secret.password=${ENCRYPTION_SECRET_PASSWORD:password}
encryption.secret.salt=${ENCRYPTION_SECRET_SALT:salt}

# ===============================
# = KEYCLOAK CONFIGURATION
# ===============================
keycloak.enabled=${KEYCLOAK_ENABLED:true}
keycloak.server-url=${KEYCLOAK_SERVER_URL:http://localhost:8180}
keycloak.realm=${KEYCLOAK_REALM:kavun}
keycloak.client-id=${KEYCLOAK_CLIENT_ID:kavun-api}
keycloak.client-secret=${KEYCLOAK_CLIENT_SECRET:kavun-secret}
keycloak.admin-username=${KEYCLOAK_ADMIN_USERNAME:admin}
keycloak.admin-password=${KEYCLOAK_ADMIN_PASSWORD:admin}

# Spring Security OAuth2 Resource Server Configuration
spring.security.oauth2.resourceserver.jwt.issuer-uri=${keycloak.server-url}/realms/${keycloak.realm}
spring.security.oauth2.resourceserver.jwt.jwk-set-uri=${keycloak.server-url}/realms/${keycloak.realm}/protocol/openid-connect/certs

# Spring Security OAuth2 Client Configuration (for form login)
spring.security.oauth2.client.registration.keycloak.client-id=${keycloak.client-id}
spring.security.oauth2.client.registration.keycloak.client-secret=${keycloak.client-secret}
spring.security.oauth2.client.registration.keycloak.authorization-grant-type=authorization_code
spring.security.oauth2.client.registration.keycloak.scope=openid,profile,email,roles
spring.security.oauth2.client.provider.keycloak.issuer-uri=${keycloak.server-url}/realms/${keycloak.realm}
spring.security.oauth2.client.provider.keycloak.user-name-attribute=preferred_username

# ===============================
# = CACHE
# ===============================
# Enable second level cache
spring.jpa.properties.hibernate.cache.use_second_level_cache=true
spring.jpa.properties.hibernate.javax.cache.missing_cache_strategy=create

# Specify the caching framework - EhCache
spring.jpa.properties.hibernate.cache.region.factory_class=jcache
spring.jpa.properties.hibernate.javax.cache.provider=org.ehcache.jsr107.EhcacheCachingProvider

# Only cache specific items with annotations
spring.jpa.properties.jakarta.persistence.sharedCache.mode=ENABLE_SELECTIVE

# Performance tuning
spring.jpa.open-in-view=false
spring.jpa.properties.hibernate.jdbc.batch_size=20
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true
spring.jpa.properties.hypersistence.query.max_result_size=50
spring.jpa.properties.hibernate.query.plan_cache_max_size=4096
spring.jpa.properties.hypersistence.session.timeout_millis=1000
spring.jpa.properties.hypersistence.session.flush_timeout_millis=1000
spring.jpa.properties.hibernate.query.in_clause_parameter_padding=true
spring.jpa.properties.hibernate.query.fail_on_pagination_over_collection_fetch=true

# ===============================
# = HIBERNATE ENVERS
# ===============================
spring.jpa.properties.org.hibernate.envers.audit_strategy=org.hibernate.envers.strategy.internal.ValidityAuditStrategy
spring.jpa.properties.org.hibernate.envers.audit_table_suffix=_AUDIT_LOG
spring.jpa.properties.org.hibernate.envers.store_data_at_delete=true
# Note: revision_field_name and revision_type_field_name use Envers defaults (rev, revtype)
# Changing these requires Liquibase migration for existing audit tables

# ===============================
# = SERVER ERROR HANDLING
# ===============================
server.error.include-stacktrace=on_param
server.error.include-message=always
server.error.include-binding-errors=always
server.max-http-request-header-size=40KB

# ===============================
# = JACKSON
# ===============================
spring.jackson.serialization.fail-on-empty-beans=false
spring.jackson.mapper.accept-case-insensitive-enums=true

# ===============================
# = Spring Data Rest
# ===============================
spring.data.rest.base-path=/api

# ===============================
# = Open API 3 / Swagger
# ===============================
springdoc.api-docs.enabled=${SPRINGDOC_API_DOCS_ENABLED:true}
springdoc.swagger-ui.enabled=${SPRINGDOC_SWAGGER_UI_ENABLED:true}
springdoc.show-actuator=${SPRINGDOC_SHOW_ACTUATOR:true}
openapi.version=${API_VERSION:1.0.0}
springdoc.swagger-ui.path=/swagger-ui
springdoc.swagger-ui.csrf.enabled=true
openapi.name=${API_NAME:${spring.application.name}}
springdoc.swagger-ui.tags-sorter=alpha
springdoc.swagger-ui.operations-sorter=method
springdoc.swagger-ui.display-request-duration=true
springdoc.swagger-ui.disable-swagger-default-url=true
springdoc.packages-to-scan=com.kavun.web.rest.v1
openapi.description=${API_DESCRIPTION: Kavun is a Spring Boot based REST API starter project. It provides a solid foundation for building scalable and maintainable applications.}

# ===============================
# LIQUIBASE
# ===============================
spring.liquibase.enabled=false
spring.liquibase.change-log=classpath:db/changelog/db.changelog-master.xml

# ===============================
# CORS Configuration
# ===============================
cors.max-age=${CORS_MAX_AGE:3600}
cors.allowed-methods=${CORS_ALLOWED_METHODS:}
cors.allowed-headers=${CORS_ALLOWED_HEADERS:}
cors.exposed-headers=${CORS_EXPOSED_HEADERS:}
cors.allow-credentials=${CORS_ALLOW_CREDENTIALS:true}
cors.allowed-origins=${CORS_ALLOWED_ORIGINS:http://localhost:3000/, http://localhost:4200/}

# ===============================
# = LOGGING CONFIGURATION (Common)
# ===============================
# File logging configuration (shared across all profiles)
logging.file.path=${LOGGING_FILE_PATH:logs}
logging.file.name=${LOGGING_FILE_NAME:logs/application.log}
logging.logback.rollingpolicy.max-file-size=${LOGGING_MAX_FILE_SIZE:10MB}
logging.logback.rollingpolicy.max-history=${LOGGING_MAX_HISTORY:30}
logging.logback.rollingpolicy.total-size-cap=${LOGGING_TOTAL_SIZE_CAP:1GB}
logging.logback.rollingpolicy.clean-history-on-start=false

# Suppress noisy Spring Security config warning (intentional AuthenticationProvider setup)
logging.level.org.springframework.security.config.annotation.authentication.configuration=ERROR


# The bean 'pageableResolver',
# defined in class path resource [org/springframework/data/rest/webmvc/config/RepositoryRestMvcConfiguration.class],
# could not be registered.
# A bean with that name has already been defined in class path resource [org/springframework/data/web/config/HateoasAwareSpringDataWebConfiguration.class],
# and overriding is disabled.
spring.main.allow-bean-definition-overriding=true

# ===============================
# = SYSLOG
# ===============================
syslog.host=${SYSLOG_HOST:localhost}
syslog.port=${SYSLOG_PORT:514}
syslog.protocol=${SYSLOG_PROTOCOL:UDP}
syslog.facility=${SYSLOG_FACILITY:LOCAL0}

# ===============================
# = SPRING BOOT ACTUATOR
# ===============================
management.endpoints.web.exposure.include=*
management.endpoint.health.probes.enabled=true
management.endpoint.health.show-details=always
management.endpoint.health.show-components=always

# ===============================
# = PROMETHEUS
# ===============================
management.endpoint.prometheus.access=READ_ONLY
management.prometheus.metrics.export.enabled=true

# ===============================
# = WEB ACCESS LOGS
# ===============================
server.tomcat.accesslog.enabled=true
server.tomcat.accesslog.directory=logs
server.tomcat.accesslog.prefix=access_log
server.tomcat.accesslog.suffix=.log
server.tomcat.accesslog.pattern=%h %l %u %t "%r" %s %b "%{Referer}i" "%{User-Agent}i"

# ===============================
# = THREAD POOL CONFIGURATION
# ===============================
spring.task.execution.pool.core-size=2
spring.task.execution.pool.max-size=4
spring.task.execution.pool.queue-capacity=50
spring.task.execution.pool.keep-alive=120s
spring.task.execution.thread-name-prefix=async-task-

# ===============================
# = DEVTOOLS
# ===============================
spring.devtools.restart.enabled=false
spring.devtools.livereload.enabled=false
spring.devtools.restart.additional-paths=src/main/resources,src/main/java
spring.devtools.restart.poll-interval=1000
spring.devtools.restart.quiet-period=400